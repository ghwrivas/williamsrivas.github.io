<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
</head>

<body>
    <div id="log" style="font-size: xxx-large;"></div>
<script>
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        
        function detectMetaBrowser() {
            document.getElementById('log').innerHTML += userAgent;
            document.getElementById('log').innerHTML += `<br><br>Navigator standalone: ${navigator.standalone}`;
            document.getElementById('log').innerHTML += `<br><br>clientInformation.standalone: ${window.clientInformation.standalone}`;
            // Comprobar si contiene alguna cadena específica de Meta/Facebook o TikTok
            if (userAgent.match(/FBAN|FBAV|Instagram|Tiktok/i)) {
                return true; // Se está ejecutando dentro de la app de Meta/Facebook o TikTok
            } else {
                return false; // No es la app de Meta/Facebook o TikTok
            }
        }

        if (detectMetaBrowser()) {
            document.getElementById('log').innerHTML += '<br><br>Viene de red social';
        } else {
            document.getElementById('log').innerHTML += '<br><br>No viene de red social';
        }
        
    </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/forge/0.10.0/forge.min.js"></script>
        <script>
            window.pubKey = "pubkey";
            const sendMessageAppParent = (message) => {
                if (window.webkit) {
                    console.log('webkit')
                    document.getElementById('log').innerHTML += '<br><br>window.webkit';
                }
                if (window.appInterface) {
                    console.log('appInterface')
                    document.getElementById('log').innerHTML += '<br><br>window.appInterface';
                }
                if (window.parent) {
                    console.log('parent')
                    document.getElementById('log').innerHTML += '<br><br>window.parent';
                }
                window.webkit ? window.webkit.messageHandlers.appInterface.postMessage(message) : null
                window.appInterface ? window.appInterface.listenMessage(message): null
                window.parent ? window.parent.postMessage({ message, origin: window.location.origin}, window.location.origin) : null
            }
            const generateRandomKey = (keyLength) => {
                const tmp = CryptoJS.lib.WordArray.random(keyLength / 8).toString(); //'585e2caeb5bb532ca2cbacb6ba50368a'
                document.getElementById('log').innerHTML += `<br><br>RamdonKey: ${tmp}`;
                console.log('FORGE', forge)
                if (forge)
                console.log('FORGE', forge.util.encodeUtf8('VALUE TO ENCRYPT'));
                sendMessageAppParent("ok");
            }
              fetch('https://jsonplaceholder.typicode.com/todos/1')
                  .then(response => response.json())
                  .then(json => console.log(json))
        </script>

    <button onclick="generateRandomKey(32)" style="font-size: xxx-large; width: 100%;">Click Me</button>
</body>

</html>
